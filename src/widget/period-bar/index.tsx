/**
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at

 * http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import { Component, Show } from "solid-js";

import { Period, SymbolInfo } from "../../types";

import i18n from "../../i18n";

export interface PeriodBarProps {
  locale: string;
  spread: boolean;
  symbol: SymbolInfo;
  period: Period;
  periods: Period[];
  onMenuClick: () => void;
  onSymbolClick: () => void;
  onPeriodChange: (period: Period) => void;
  onIndicatorClick: () => void;
  onTimezoneClick: () => void;
  onSettingClick: () => void;
  onScreenshotClick: () => void;
}

const PeriodBar: Component<PeriodBarProps> = (props) => {
  let ref: Node;

  return (
    <div
      ref={(el) => {
        ref = el;
      }}
      class="klinecharts-pro-period-bar"
      style={{
        overflow: "auto",
        height: "60px",
      }}
    >
      <div class="menu-container">
        <svg
          class={props.spread ? "" : "rotate"}
          viewBox="0 0 1024 1024"
          onClick={props.onMenuClick}
        >
          <path d="M192.037 287.953h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32zM832.161 479.169H438.553c-17.673 0-32 14.327-32 32s14.327 32 32 32h393.608c17.673 0 32-14.327 32-32s-14.327-32-32-32zM832.161 735.802H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32zM319.028 351.594l-160 160 160 160z" />
        </svg>
      </div>
      <Show when={props.symbol}>
        <div class="symbol" onClick={props.onSymbolClick}>
          <Show when={props.symbol.logo}>
            <img alt="symbol" src={props.symbol.logo} />
          </Show>
          <span>
            {props.symbol.shortName ?? props.symbol.name ?? props.symbol.ticker}
          </span>
        </div>
      </Show>
      {props.periods.map((p) => (
        <span
          class={`item period ${
            p.text === props.period.text ? "selected" : ""
          }`}
          onClick={() => {
            props.onPeriodChange(p);
          }}
        >
          {p.text}
        </span>
      ))}
      <div class="item tools" onClick={props.onIndicatorClick}>
        <svg viewBox="0 0 20 20">
          <path d="M15.873,20L3.65079,20C1.5873,20,0,18.3871,0,16.2903L0,3.70968C-3.78442e-7,1.6129,1.5873,0,3.65079,0L15.873,0C17.9365,0,19.5238,1.6129,19.5238,3.70968C19.5238,4.35484,19.2063,4.51613,18.5714,4.51613C17.9365,4.51613,17.619,4.19355,17.619,3.70968C17.619,2.74194,16.8254,1.93548,15.873,1.93548L3.65079,1.93548C2.69841,1.93548,1.90476,2.74194,1.90476,3.70968L1.90476,16.2903C1.90476,17.2581,2.69841,18.0645,3.65079,18.0645L15.873,18.0645C16.8254,18.0645,17.619,17.2581,17.619,16.2903C17.619,15.8065,18.0952,15.3226,18.5714,15.3226C19.0476,15.3226,19.5238,15.8065,19.5238,16.2903C19.5238,18.2258,17.9365,20,15.873,20ZM14.9206,12.9032C14.7619,12.9032,14.4444,12.9032,14.2857,12.7419L11.2698,9.35484C10.9524,9.03226,10.9524,8.54839,11.2698,8.22581C11.5873,7.90323,12.0635,7.90323,12.381,8.22581L15.3968,11.6129C15.7143,11.9355,15.7143,12.4194,15.3968,12.7419C15.3968,12.9032,15.2381,12.9032,14.9206,12.9032ZM11.4286,13.2258C11.2698,13.2258,11.1111,13.2258,10.9524,13.0645C10.6349,12.7419,10.6349,12.4194,10.9524,12.0968L15.0794,7.74193C15.3968,7.41935,15.7143,7.41935,16.0317,7.74193C16.3492,8.06452,16.3492,8.3871,16.0317,8.70968L11.9048,13.0645C11.746,13.2258,11.5873,13.2258,11.4286,13.2258ZM10.3175,3.70968C10.6349,3.70968,11.4286,3.87097,11.4286,4.67742C11.4286,5.32258,10.4762,5.16129,10.1587,5.16129C8.73016,5.16129,8.25397,5.96774,8.09524,6.6129L7.77778,8.54839L9.36508,8.54839C9.68254,8.54839,10,8.87097,10,9.19355C10,9.51613,9.68254,9.83871,9.36508,9.83871L7.61905,9.83871L6.50794,14.8387Q6.34921,16.2903,5.39683,16.2903Q4.44444,16.2903,4.92064,14.8387L6.03175,10L4.60317,10C4.28571,10,3.96825,9.67742,3.96825,9.35484C3.96825,8.70968,4.28571,8.54839,4.60317,8.54839L6.34921,8.54839L6.8254,6.45161C7.14286,3.70968,9.52381,3.54839,10.3175,3.70968ZM18.4127,6.6129C18.5714,6.12903,18.8889,5.96774,19.3651,5.96774C19.8413,6.12903,20,6.45161,20,6.93548L18.4127,13.3871C18.254,13.871,17.9365,14.0323,17.4603,14.0323C16.9841,13.871,16.8254,13.5484,16.8254,13.0645L18.4127,6.6129Z" />
        </svg>
        <span>{i18n("indicator", props.locale)}</span>
      </div>
    </div>
  );
};

export default PeriodBar;
